{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Debate Transcript Schema",
  "description": "Schema for multi-agent fact verification debate transcripts",
  "type": "object",
  "required": ["generated_at", "model", "total_cases", "summary", "debates"],
  "properties": {
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp when debates were generated"
    },
    "model": {
      "type": "string",
      "description": "LLM model used (e.g., gpt-4o-mini, gpt-4o)"
    },
    "total_cases": {
      "type": "integer",
      "description": "Number of cases analyzed"
    },
    "summary": {
      "type": "object",
      "properties": {
        "faithful": { "type": "integer" },
        "mutated": { "type": "integer" },
        "uncertain": { "type": "integer" }
      },
      "required": ["faithful", "mutated", "uncertain"]
    },
    "debates": {
      "type": "array",
      "items": { "$ref": "#/definitions/Debate" }
    }
  },
  "definitions": {
    "Debate": {
      "type": "object",
      "required": ["case_id", "claim", "truth", "timestamp", "model", "rounds"],
      "properties": {
        "case_id": { "type": "integer" },
        "claim": { "type": "string" },
        "truth": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "model": { "type": "string" },
        "rounds": {
          "type": "object",
          "required": ["round1_initial_stances", "round2_cross_examination", "round3_consensus"],
          "properties": {
            "round1_initial_stances": {
              "type": "array",
              "items": { "$ref": "#/definitions/InitialStance" }
            },
            "round2_cross_examination": {
              "type": "array",
              "items": { "$ref": "#/definitions/CrossExamResponse" }
            },
            "round3_consensus": { "$ref": "#/definitions/Consensus" }
          }
        }
      }
    },
    "InitialStance": {
      "type": "object",
      "required": ["agent", "verdict", "confidence", "arguments", "reasoning_summary"],
      "properties": {
        "agent": {
          "type": "string",
          "enum": ["FACT_CHECKER", "SKEPTIC", "CONTEXTUALIST"]
        },
        "verdict": {
          "type": "string",
          "enum": ["faithful", "mutated", "uncertain"]
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "arguments": {
          "type": "array",
          "items": { "$ref": "#/definitions/Argument" }
        },
        "reasoning_summary": { "type": "string" }
      }
    },
    "Argument": {
      "type": "object",
      "required": ["id", "text"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Argument ID (e.g., FC1, SK1, CX1)"
        },
        "text": {
          "type": "string",
          "description": "The argument statement"
        },
        "evidence_quote": {
          "type": ["string", "null"],
          "description": "Direct quote from claim or truth supporting argument"
        },
        "severity": {
          "type": ["string", "null"],
          "enum": ["high", "medium", "low", null],
          "description": "Severity of the issue identified"
        }
      }
    },
    "CrossExamResponse": {
      "type": "object",
      "required": ["agent", "target_agent", "target_argument_id", "action", "response_text", "updated_confidence"],
      "properties": {
        "agent": {
          "type": "string",
          "description": "Agent making the response"
        },
        "target_agent": {
          "type": "string",
          "description": "Agent whose argument is being addressed"
        },
        "target_argument_id": {
          "type": "string",
          "description": "ID of the argument being addressed"
        },
        "action": {
          "type": "string",
          "enum": ["attack", "concede"],
          "description": "Whether agent attacks or concedes the point"
        },
        "response_text": {
          "type": "string",
          "description": "The agent's response explaining their attack/concession"
        },
        "updated_confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "Consensus": {
      "type": "object",
      "required": ["final_verdict", "confidence", "majority_position", "key_agreements", "unresolved_disputes", "reasoning"],
      "properties": {
        "final_verdict": {
          "type": "string",
          "enum": ["faithful", "mutated", "uncertain"]
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "majority_position": {
          "type": "string",
          "description": "Brief description of the majority view"
        },
        "key_agreements": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Points all agents agreed on"
        },
        "unresolved_disputes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Points that remained contested"
        },
        "reasoning": {
          "type": "string",
          "description": "Moderator's explanation of the final verdict"
        }
      }
    }
  }
}
